<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sovereign Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Vapi SDK (Browser UMD Build) -->
    <script src="https://unpkg.com/@vapi-ai/web/dist/vapi.umd.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body {
            background-color: #020617;
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8080RNWHVV">
    </script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-8080RNWHVV');
    </script>
    <link rel="stylesheet" href="css/autofix.css">
</head>

<body class="p-8 overflow-x-hidden">
    <!-- CONFIG -->
    <script>
        // SOVEREIGN CREDENTIALS (Client-Side Safe for Dashboard)
        const SUPABASE_URL = "https://rzcpfwkygdvoshtwxncs.supabase.co";
        // Verified Anon Key (2026-01-09 - FRESH from Supabase dashboard)
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6Y3Bmd2t5Z2R2b3NodHd4bmNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1OTA0MjQsImV4cCI6MjA4MjE2NjQyNH0.dluuiK-jr-3Z_oksYHS4saSthpkppLHQGnl6YtploPU";

        // VAPI
        const VAPI_PUBLIC_KEY = "3b065ff0-a721-4b66-8255-30b6b8d6daab";
        // "John" as the Orchestrator
        const ORCHESTRATOR_ID = "78b4c14a-4db3-4416-9289-d1bfd2409606";

        const sbClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Vapi initialization with error handling (SDK may not load correctly)
        let vapi = null;
        try {
            if (window.Vapi) {
                vapi = new window.Vapi(VAPI_PUBLIC_KEY);
            } else if (window.vapi) {
                vapi = new window.vapi(VAPI_PUBLIC_KEY);
            }
        } catch (e) {
            console.warn('[Dashboard] Vapi SDK failed to initialize:', e.message);
        }
    </script>

    <div class="max-w-7xl mx-auto">

        <!-- Header -->
        <nav class="glass rounded-2xl p-4 mb-6 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-xl">‚ö°</div>
                <div>
                    <h1 class="font-bold text-xl">Sovereign Command</h1>
                    <div class="text-xs text-green-400">‚óè Systems Online</div>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="window.open('https://app.gohighlevel.com')"
                    class="px-4 py-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition text-sm">Targeting
                    (GHL)</button>
                <button onclick="window.open('https://dashboard.vapi.ai')"
                    class="px-4 py-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition text-sm">Voice Grid
                    (Vapi)</button>
            </div>
        </nav>

        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="glass p-6 rounded-2xl">
                <h3 class="text-slate-400 text-xs font-semibold uppercase">Total Leads</h3>
                <div class="text-3xl font-bold mt-2" id="statLeads">--</div>
            </div>
            <div class="glass p-6 rounded-2xl">
                <h3 class="text-slate-400 text-xs font-semibold uppercase">Pipeline Value</h3>
                <div class="text-3xl font-bold mt-2 text-green-400" id="statPipeline">--</div>
            </div>
            <div class="glass p-6 rounded-2xl">
                <h3 class="text-slate-400 text-xs font-semibold uppercase">Calls Made</h3>
                <div class="text-3xl font-bold mt-2 text-blue-400" id="statCalls">--</div>
            </div>
            <div class="glass p-6 rounded-2xl">
                <h3 class="text-slate-400 text-xs font-semibold uppercase">Appointments</h3>
                <div class="text-3xl font-bold mt-2 text-purple-400" id="statAppts">--</div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">

            <!-- ORCHESTRATOR UPLINK -->
            <div
                class="glass p-6 rounded-2xl flex flex-col items-center justify-center text-center relative overflow-hidden">
                <div
                    class="w-20 h-20 bg-blue-500/20 rounded-full flex items-center justify-center mb-4 border border-blue-400/30">
                    <span class="text-4xl">üéôÔ∏è</span>
                </div>
                <h2 class="text-xl font-bold mb-1">Direct Uplink</h2>
                <p class="text-slate-400 text-xs mb-6">Talk to Antigravity (Orchestrator)</p>

                <button id="btnUplink" onclick="toggleUplink()"
                    class="px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold w-full transition shadow-lg shadow-blue-500/20">
                    INITIATE LINK
                </button>
                <div id="statusUplink" class="mt-3 text-xs text-slate-500 font-mono">Status: Standby</div>
            </div>

            <!-- ACTIVE CAMPAIGN FEED -->
            <div class="glass p-6 rounded-2xl col-span-2 flex flex-col h-[400px]">
                <div class="flex justify-between items-center mb-4 border-b border-white/5 pb-2">
                    <h3 class="font-bold flex items-center gap-2">
                        <span>üì°</span> Live Campaign Feed
                    </h3>
                    <div class="flex gap-2">
                        <select id="campaignFilter" aria-label="Campaign Filter" onchange="fetchLeads()"
                            class="bg-slate-900 border border-slate-700 text-xs rounded px-2 py-1 outline-none text-slate-300">
                            <option value="ALL">All Campaigns</option>
                            <option value="roofing">Roofing (Foofer)</option>
                            <option value="hvac">HVAC</option>
                        </select>
                        <button onclick="fetchLeads()" class="text-xs text-blue-400 hover:text-blue-300">‚Üª
                            Refresh</button>
                    </div>
                </div>

                <!-- Table Header -->
                <div class="grid grid-cols-12 gap-2 text-xs text-slate-500 uppercase font-semibold mb-2 px-2">
                    <div class="col-span-4">Company / Name</div>
                    <div class="col-span-3">Status</div>
                    <div class="col-span-3">Details</div>
                    <div class="col-span-2 text-right">Action</div>
                </div>

                <!-- Scrollable Body -->
                <div class="flex-1 overflow-y-auto space-y-2 pr-2" id="leadsContainer">
                    <!-- Rows injected here -->
                    <div class="text-center text-slate-500 py-10">Connecting to Neural Net...</div>
                </div>
            </div>
        </div>

        <!-- OUTREACH ACTIVITY (Emails, SMS, Calls) -->
        <div class="glass p-6 rounded-2xl mb-6">
            <div class="flex justify-between items-center mb-4 border-b border-white/5 pb-2">
                <h3 class="font-bold flex items-center gap-2">
                    <span>üìä</span> Outreach Activity Feed
                </h3>
                <button onclick="fetchActivity()" class="text-xs text-blue-400 hover:text-blue-300">‚Üª Refresh</button>
            </div>
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div class="bg-blue-500/10 p-3 rounded-lg text-center">
                    <div id="emailCount" class="text-2xl font-bold text-blue-400">-</div>
                    <div class="text-xs text-slate-400">Emails Sent</div>
                </div>
                <div class="bg-green-500/10 p-3 rounded-lg text-center">
                    <div id="smsCount" class="text-2xl font-bold text-green-400">-</div>
                    <div class="text-xs text-slate-400">SMS Sent</div>
                </div>
                <div class="bg-purple-500/10 p-3 rounded-lg text-center">
                    <div id="callCount" class="text-2xl font-bold text-purple-400">-</div>
                    <div class="text-xs text-slate-400">Calls Made</div>
                </div>
            </div>
            <div id="activityContainer" class="space-y-2 max-h-[300px] overflow-y-auto">
                <div class="text-center text-slate-500 py-4">Loading activity...</div>
            </div>
        </div>

        <!-- CALL TRANSCRIPTS (Brain Training Data) -->
        <div class="glass p-6 rounded-2xl mb-6">
            <div class="flex justify-between items-center mb-4 border-b border-white/5 pb-2">
                <h3 class="font-bold flex items-center gap-2">
                    <span>üìû</span> Call Transcripts & AI Learnings
                </h3>
                <button onclick="fetchTranscripts()" class="text-xs text-blue-400 hover:text-blue-300">‚Üª
                    Refresh</button>
            </div>
            <div id="transcriptsContainer" class="space-y-3 max-h-[400px] overflow-y-auto">
                <div class="text-center text-slate-500 py-6">Loading transcripts...</div>
            </div>
        </div>

        <!-- ASSET INBOX (Feed the Brain) -->
        <div class="glass p-6 rounded-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold">üì• Asset Inbox (Feed The Brain)</h3>
                <span class="text-xs text-slate-500">Drag & Drop or Paste URL</span>
            </div>
            <div id="dropZone"
                class="border-2 border-dashed border-white/10 rounded-xl p-8 flex flex-col items-center justify-center text-center hover:border-blue-500/50 hover:bg-blue-500/5 transition cursor-pointer">
                <span class="text-2xl mb-2">üß†</span>
                <p class="text-sm text-slate-300 mb-2">"Here, learn this."</p>
                <input type="text" id="assetInput" placeholder="Paste URL..."
                    class="bg-slate-900 text-xs px-3 py-2 rounded border border-slate-700 w-64 text-center focus:border-blue-500 outline-none">
                <button onclick="saveAsset()"
                    class="mt-3 px-4 py-1 bg-green-600 hover:bg-green-500 rounded text-xs font-bold">SAVE TO
                    BRAIN</button>
                <div id="assetStatus" class="mt-2 text-[10px] text-slate-500"></div>
            </div>
        </div>

    </div>

    <!-- LOGIC -->
    <script>
        // --- 1. DATA FETCHING ---
        async function fetchStats() {
            // Simple counts
            const { count: total } = await sbClient.from('leads').select('*', { count: 'exact', head: true });
            const { count: contacted } = await sbClient.from('leads').select('*', { count: 'exact', head: true }).eq('status', 'contacted');
            const { count: calls } = await sbClient.from('call_transcripts').select('*', { count: 'exact', head: true });
            // "Appointments" approximated
            const { count: appts } = await sbClient.from('leads').select('*', { count: 'exact', head: true }).in('status', ['converted', 'appointment_set']);

            document.getElementById('statLeads').innerText = total || 0;
            // Dummy logic: $1000 per contacted lead for pipeline
            document.getElementById('statPipeline').innerText = "$" + ((contacted || 0) * 1000).toLocaleString();
            document.getElementById('statCalls').innerText = calls || 0;
            document.getElementById('statAppts').innerText = appts || 0;
        }

        async function fetchLeads() {
            const filter = document.getElementById('campaignFilter').value;
            let query = sbClient.from('leads').select('*').order('created_at', { ascending: false }).limit(50);

            // Note: 'industry' is inside 'agent_research' JSONB usually, so perfect filtering might require raw SQL or standardized columns.
            // For now, we fetch recent 50 and filter client side if needed, or rely on implicit order.

            const { data, error } = await query;
            if (error) { console.error(error); return; }

            const container = document.getElementById('leadsContainer');
            container.innerHTML = '';

            data.forEach(lead => {
                // Parse JSONB
                const meta = typeof lead.agent_research === 'string' ? JSON.parse(lead.agent_research) : lead.agent_research || {};
                const industry = meta.industry || 'General';
                const phone = meta.phone || lead.phone || 'Unknown';

                // Color Code
                let badgeClass = "bg-slate-700 text-slate-300";
                if (lead.status === 'processing_email') badgeClass = "bg-orange-500/20 text-orange-400";
                if (lead.status === 'contacted') badgeClass = "bg-blue-500/20 text-blue-400";
                if (lead.status === 'system_crash') badgeClass = "bg-red-500/20 text-red-400 animate-pulse";
                if (lead.status === 'warming_up') badgeClass = "bg-yellow-500/20 text-yellow-400";

                const div = document.createElement('div');
                div.className = "grid grid-cols-12 gap-2 bg-white/5 p-3 rounded-lg items-center hover:bg-white/10 transition";
                div.innerHTML = `
                    <div class="col-span-4">
                        <div class="font-bold text-sm text-white truncate">${lead.company_name || 'Prospect'}</div>
                        <div class="text-[10px] text-slate-400">${industry}</div>
                    </div>
                    <div class="col-span-3">
                        <span class="px-2 py-1 rounded text-[10px] font-bold uppercase ${badgeClass}">${lead.status}</span>
                    </div>
                    <div class="col-span-3 text-[10px] font-mono text-slate-500">
                        ${phone}<br>
                        <span title="Created At">${new Date(lead.created_at).toLocaleString()}</span>
                    </div>
                    <div class="col-span-2 text-right">
                         <button onclick="viewDossier('${lead.id}')" class="text-blue-400 hover:text-white text-xs underline">VIEW</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        async function viewDossier(id) {
            // Fetch lead details
            const { data, error } = await sbClient.from('leads').select('*').eq('id', id).single();

            if (error || !data) {
                alert('Could not load lead details');
                return;
            }

            // Parse research data
            let research = data.agent_research || {};
            if (typeof research === 'string') {
                try { research = JSON.parse(research); } catch (e) { research = {}; }
            }

            // Build dossier content
            const phone = research.phone || data.phone || 'N/A';
            const email = research.email || data.email || 'N/A';
            const website = research.website || 'N/A';
            const owner = research.owner_name || research.owner || 'Unknown';
            const city = data.city || research.city || 'N/A';
            const industry = data.industry || 'N/A';

            const content = `
<div class="style-fix-8" data-style-migrated="true">
    <h2 class="style-fix-9" data-style-migrated="true">üìã ${data.company_name || 'Prospect'}</h2>
    <div class="style-fix-10" data-style-migrated="true">
        <div><strong class="style-fix-11" data-style-migrated="true">Status:</strong> ${data.status}</div>
        <div><strong class="style-fix-11" data-style-migrated="true">Industry:</strong> ${industry}</div>
        <div><strong class="style-fix-11" data-style-migrated="true">City:</strong> ${city}</div>
        <hr class="style-fix-12" data-style-migrated="true">
        <div><strong class="style-fix-11" data-style-migrated="true">üìû Phone:</strong> ${phone}</div>
        <div><strong class="style-fix-11" data-style-migrated="true">üìß Email:</strong> ${email}</div>
        <div><strong class="style-fix-11" data-style-migrated="true">üåê Website:</strong> ${website}</div>
        <div><strong class="style-fix-11" data-style-migrated="true">üë§ Owner:</strong> ${owner}</div>
        <hr class="style-fix-12" data-style-migrated="true">
        <div><strong class="style-fix-11" data-style-migrated="true">Created:</strong> ${new Date(data.created_at).toLocaleString()}</div>
        <div><strong class="style-fix-11" data-style-migrated="true">Last Called:</strong> ${data.last_called ? new Date(data.last_called).toLocaleString() : 'Never'}</div>
    </div>
    <button onclick="this.parentElement.parentElement.remove()" class="style-fix-13" data-style-migrated="true">Close</button>
</div>`;

            // Show modal
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:9999;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
            modal.innerHTML = content;
            document.body.appendChild(modal);
        }

        // --- ACTIVITY FETCHING ---
        async function fetchActivity() {
            const container = document.getElementById('activityContainer');
            container.innerHTML = '<div class="text-center text-slate-500 py-4">Loading...</div>';

            try {
                // Get recent system logs for activity
                const { data, error } = await sbClient
                    .from('system_logs')
                    .select('*')
                    .in('event_type', ['CLOUD_OUTREACH_COMPLETE', 'CLOUD_DRIP_COMPLETE', 'MULTI_TOUCH_SEQUENCE', 'EMAIL_SENT', 'SMS_SENT', 'CALL_MADE'])
                    .order('created_at', { ascending: false })
                    .limit(50);

                if (error) throw error;

                // Count totals
                let emails = 0, sms = 0, calls = 0;
                if (data) {
                    data.forEach(log => {
                        const meta = log.metadata || {};
                        if (meta.email) emails += meta.email;
                        if (meta.sent) emails += meta.sent;
                        if (meta.sms) sms += meta.sms;
                        if (meta.call) calls += meta.call;
                        if (log.event_type === 'EMAIL_SENT') emails++;
                        if (log.event_type === 'SMS_SENT') sms++;
                        if (log.event_type === 'CALL_MADE') calls++;
                    });
                }

                document.getElementById('emailCount').textContent = emails;
                document.getElementById('smsCount').textContent = sms;
                document.getElementById('callCount').textContent = calls;

                // Display activity feed
                if (!data || data.length === 0) {
                    container.innerHTML = '<div class="text-center text-slate-500 py-4">No recent activity</div>';
                    return;
                }

                container.innerHTML = '';
                data.slice(0, 15).forEach(log => {
                    const time = new Date(log.created_at).toLocaleTimeString();
                    const date = new Date(log.created_at).toLocaleDateString();
                    let icon = 'üìß';
                    if (log.event_type.includes('SMS')) icon = 'üì±';
                    if (log.event_type.includes('CALL')) icon = 'üìû';
                    if (log.event_type.includes('DRIP')) icon = 'üíß';
                    if (log.event_type.includes('OUTREACH')) icon = 'üöÄ';

                    const div = document.createElement('div');
                    div.className = 'bg-slate-800/30 rounded p-2 text-xs flex items-center gap-2';
                    div.innerHTML = `
                        <span>${icon}</span>
                        <span class="flex-1 text-slate-300">${log.message || log.event_type}</span>
                        <span class="text-slate-500">${date} ${time}</span>
                    `;
                    container.appendChild(div);
                });
            } catch (err) {
                console.error('Activity fetch error:', err);
                container.innerHTML = '<div class="text-center text-red-400 py-4">Error loading activity</div>';
            }
        }

        // --- TRANSCRIPTS FETCHING ---
        async function fetchTranscripts() {
            const container = document.getElementById('transcriptsContainer');
            container.innerHTML = '<div class="text-center text-slate-500 py-4">Loading...</div>';

            try {
                const { data, error } = await sbClient
                    .from('call_transcripts')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(20);

                if (error) throw error;

                if (!data || data.length === 0) {
                    container.innerHTML = '<div class="text-center text-slate-500 py-6">No call transcripts yet. Make some calls!</div>';
                    return;
                }

                container.innerHTML = '';

                data.forEach((t, i) => {
                    const date = new Date(t.created_at).toLocaleDateString() + ' ' + new Date(t.created_at).toLocaleTimeString();
                    const phone = t.phone_number || 'Unknown';
                    const sentiment = t.sentiment || 'N/A';
                    const summary = t.summary || 'No summary';
                    const transcript = t.transcript || 'No transcript available';

                    // Sentiment color
                    let sentimentClass = 'text-slate-400';
                    if (sentiment && sentiment.toLowerCase().includes('positive')) sentimentClass = 'text-green-400';
                    if (sentiment && sentiment.toLowerCase().includes('negative')) sentimentClass = 'text-red-400';

                    const div = document.createElement('div');
                    div.className = 'bg-slate-800/50 rounded-lg p-4 border border-white/5';
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <span class="font-bold text-white">üìû ${phone}</span>
                                <span class="text-xs text-slate-500 ml-2">${date}</span>
                            </div>
                            <span class="text-xs px-2 py-1 rounded ${sentimentClass} bg-white/5">${sentiment}</span>
                        </div>
                        <p class="text-sm text-slate-300 mb-2">${summary.substring(0, 200)}${summary.length > 200 ? '...' : ''}</p>
                        <details class="mt-2">
                            <summary class="text-xs text-blue-400 cursor-pointer hover:text-blue-300">üìú View Full Transcript</summary>
                            <pre class="mt-2 p-3 bg-slate-900 rounded text-xs text-slate-400 whitespace-pre-wrap max-h-48 overflow-y-auto">${transcript}</pre>
                        </details>
                    `;
                    container.appendChild(div);
                });
            } catch (err) {
                container.innerHTML = '<div class="text-center text-red-400 py-4">Error loading transcripts: ' + err.message + '</div>';
            }
        }

        // --- 2. VAPI UPLINK (with null safety) ---
        let isConnected = false;

        // Only attach listeners if vapi initialized successfully
        if (vapi) {
            vapi.on('call-start', () => {
                console.log('Call started');
                document.getElementById('statusUplink').innerText = "Status: üü¢ ONLINE (Secure Channel)";
                document.getElementById('statusUplink').className = "mt-3 text-xs text-green-400 font-bold font-mono animate-pulse";
                document.getElementById('btnUplink').innerText = "DISCONNECT";
                document.getElementById('btnUplink').className = "px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold w-full transition shadow-lg shadow-red-500/20";
            });

            vapi.on('call-end', () => {
                console.log('Call ended');
                resetUplinkUI();
            });
        }

        function resetUplinkUI() {
            isConnected = false;
            document.getElementById('statusUplink').innerText = "Status: Standby";
            document.getElementById('statusUplink').className = "mt-3 text-xs text-slate-500 font-mono";
            document.getElementById('btnUplink').innerText = "INITIATE LINK";
            document.getElementById('btnUplink').className = "px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold w-full transition shadow-lg shadow-blue-500/20";
        }

        function toggleUplink() {
            if (!vapi) {
                document.getElementById('statusUplink').innerText = "Status: Voice SDK unavailable";
                return;
            }
            if (isConnected) {
                vapi.stop();
                isConnected = false;
            } else {
                document.getElementById('statusUplink').innerText = "Status: Handshaking...";
                vapi.start(ORCHESTRATOR_ID);
                isConnected = true;
            }
        }

        // --- 3. ASSET INBOX ---
        async function saveAsset() {
            const url = document.getElementById('assetInput').value;
            const status = document.getElementById('assetStatus');

            if (!url) return;
            status.innerText = "Ingesting...";
            status.className = "mt-2 text-[10px] text-blue-400";

            // Push to Supabase 'asset_inbox' or just 'system_logs' for now if table missing
            // We'll trust 'leads' table for loose storage if needed, but better to log it.
            const { error } = await sbClient.from('system_logs').insert({
                level: 'INFO',
                event_type: 'ASSET_UPLOAD',
                message: 'Asset Uploaded from Dashboard: ' + url,
                metadata: { url: url, source: 'dashboard' }
            });

            if (!error) {
                status.innerText = "‚úÖ Saved to Brain";
                status.className = "mt-2 text-[10px] text-green-400";
                document.getElementById('assetInput').value = "";
                setTimeout(() => status.innerText = "", 3000);
            } else {
                status.innerText = "‚ùå Error";
                status.className = "mt-2 text-[10px] text-red-500";
            }
        }

        // --- 4. INIT ---
        window.addEventListener('load', () => {
            fetchStats();
            fetchLeads();
            fetchTranscripts();
            setInterval(fetchStats, 10000); // 10s refresh
            setInterval(fetchLeads, 10000);
        });

    </script>
</body>

</html>